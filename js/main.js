// Data Siswa Papua
const siswaData = [
    {
        id: 1,
        nama: "Yohanis Kambu",
        jenisKelamin: "Laki-laki",
        umur: 25,
        program: "Keaksaraan",
        tanggalBergabung: "15 Januari 2023",
        foto: "../images/siswa/siswa1.jpg",
        biodata: {
            namaLengkap: "Yohanis Kambu",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "15 Maret 1998",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567890",
            pendidikan: "SD Kelas 4",
        },
    },
    {
        id: 2,
        nama: "Martha Wenda",
        jenisKelamin: "Perempuan",
        umur: 32,
        program: "Keterampilan Komputer",
        tanggalBergabung: "20 Februari 2023",
        foto: "../images/siswa/siswa2.jpg",
        biodata: {
            namaLengkap: "Martha Wenda",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "10 Juli 1991",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567891",
            pendidikan: "SD Kelas 5",
        },
    },
    {
        id: 3,
        nama: "Alberth Dimara",
        jenisKelamin: "Laki-laki",
        umur: 28,
        program: "Kesetaraan Paket A",
        tanggalBergabung: "10 Maret 2023",
        foto: "../images/siswa/siswa3.jpg",
        biodata: {
            namaLengkap: "Alberth Dimara",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "20 Mei 1995",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567892",
            pendidikan: "SD Kelas 3",
        },
    },
    {
        id: 4,
        nama: "Yuliana Tabuni",
        jenisKelamin: "Perempuan",
        umur: 35,
        program: "Kerajinan Tangan",
        tanggalBergabung: "5 April 2023",
        foto: "../images/siswa/siswa4.jpg",
        biodata: {
            namaLengkap: "Yuliana Tabuni",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "15 Agustus 1988",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567893",
            pendidikan: "SD Kelas 6",
        },
    },
    {
        id: 5,
        nama: "Samuel Kogoya",
        jenisKelamin: "Laki-laki",
        umur: 30,
        program: "Keaksaraan",
        tanggalBergabung: "12 Mei 2023",
        foto: "../images/siswa/siswa5.jpg",
        biodata: {
            namaLengkap: "Samuel Kogoya",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "30 November 1993",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567894",
            pendidikan: "SD Kelas 4",
        },
    },
    {
        id: 6,
        nama: "Debora Mabel",
        jenisKelamin: "Perempuan",
        umur: 27,
        program: "Keterampilan Komputer",
        tanggalBergabung: "18 Juni 2023",
        foto: "../images/siswa/siswa6.jpg",
        biodata: {
            namaLengkap: "Debora Mabel",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "22 April 1996",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567895",
            pendidikan: "SD Kelas 5",
        },
    },
    {
        id: 7,
        nama: "Yakobus Noriwari",
        jenisKelamin: "Laki-laki",
        umur: 33,
        program: "Kesetaraan Paket B",
        tanggalBergabung: "22 Juli 2023",
        foto: "../images/siswa/siswa7.jpg",
        biodata: {
            namaLengkap: "Yakobus Noriwari",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "18 September 1990",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567896",
            pendidikan: "SMP Kelas 2",
        },
    },
    {
        id: 8,
        nama: "Maria Wanimbo",
        jenisKelamin: "Perempuan",
        umur: 29,
        program: "Kerajinan Tangan",
        tanggalBergabung: "8 Agustus 2023",
        foto: "../images/siswa/siswa8.jpg",
        biodata: {
            namaLengkap: "Maria Wanimbo",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "12 Desember 1994",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567897",
            pendidikan: "SD Kelas 6",
        },
    },
    {
        id: 9,
        nama: "Benny Wandikbo",
        jenisKelamin: "Laki-laki",
        umur: 31,
        program: "Keaksaraan",
        tanggalBergabung: "14 September 2023",
        foto: "../images/siswa/siswa9.jpg",
        biodata: {
            namaLengkap: "Benny Wandikbo",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "8 Maret 1992",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567898",
            pendidikan: "SD Kelas 3",
        },
    },
    {
        id: 10,
        nama: "Ruth Yogi",
        jenisKelamin: "Perempuan",
        umur: 26,
        program: "Keterampilan Komputer",
        tanggalBergabung: "25 Oktober 2023",
        foto: "../images/siswa/siswa10.jpg",
        biodata: {
            namaLengkap: "Ruth Yogi",
            tempatLahir: "Nakai, Pulau Tiga",
            tanggalLahir: "30 Juni 1997",
            alamat: "Kampung Nakai, Distrik Pulau Tiga",
            noTelepon: "081234567899",
            pendidikan: "SD Kelas 5",
        },
    },
];

// Data Nilai Siswa Papua
const nilaiData = [
    {
        id: 1,
        nama: "Yohanis Kambu",
        matematika: 75,
        bahasaIndonesia: 80,
        ipa: 78,
        ips: 82,
        pkn: 76,
        sbdp: 85,
        pjok: 88,
    },
    {
        id: 2,
        nama: "Martha Wenda",
        matematika: 85,
        bahasaIndonesia: 88,
        ipa: 90,
        ips: 92,
        pkn: 87,
        sbdp: 89,
        pjok: 91,
    },
    {
        id: 3,
        nama: "Alberth Dimara",
        matematika: 70,
        bahasaIndonesia: 75,
        ipa: 72,
        ips: 78,
        pkn: 74,
        sbdp: 80,
        pjok: 82,
    },
    {
        id: 4,
        nama: "Yuliana Tabuni",
        matematika: 90,
        bahasaIndonesia: 85,
        ipa: 88,
        ips: 87,
        pkn: 89,
        sbdp: 92,
        pjok: 86,
    },
    {
        id: 5,
        nama: "Samuel Kogoya",
        matematika: 65,
        bahasaIndonesia: 70,
        ipa: 68,
        ips: 72,
        pkn: 66,
        sbdp: 75,
        pjok: 78,
    },
    {
        id: 6,
        nama: "Debora Mabel",
        matematika: 82,
        bahasaIndonesia: 85,
        ipa: 80,
        ips: 84,
        pkn: 83,
        sbdp: 87,
        pjok: 89,
    },
    {
        id: 7,
        nama: "Yakobus Noriwari",
        matematika: 78,
        bahasaIndonesia: 82,
        ipa: 79,
        ips: 81,
        pkn: 80,
        sbdp: 83,
        pjok: 85,
    },
    {
        id: 8,
        nama: "Maria Wanimbo",
        matematika: 88,
        bahasaIndonesia: 84,
        ipa: 86,
        ips: 89,
        pkn: 85,
        sbdp: 90,
        pjok: 87,
    },
    {
        id: 9,
        nama: "Benny Wandikbo",
        matematika: 72,
        bahasaIndonesia: 68,
        ipa: 70,
        ips: 75,
        pkn: 69,
        sbdp: 78,
        pjok: 80,
    },
    {
        id: 10,
        nama: "Ruth Yogi",
        matematika: 80,
        bahasaIndonesia: 83,
        ipa: 85,
        ips: 87,
        pkn: 82,
        sbdp: 88,
        pjok: 90,
    },
];

// Initialize PKBM global object
if (!window.PKBM) {
    window.PKBM = {};
}

// Store data in global object for access from other files
window.PKBM.siswaData = siswaData;
window.PKBM.nilaiData = nilaiData;

// Also store the Papua data for compatibility
window.PKBM.siswaDataPapua = siswaData;
window.PKBM.nilaiDataPapua = nilaiData.map((item) => ({
    id: item.id,
    nama: item.nama,
    program: siswaData.find((s) => s.id === item.id)?.program || "Umum",
    nilai: {
        matematika: item.matematika,
        bahasaIndonesia: item.bahasaIndonesia,
        ipa: item.ipa,
        ips: item.ips,
        pkn: item.pkn,
        sbdp: item.sbdp,
        pjok: item.pjok,
    },
    rataRata: calculateRataRata(item),
}));

// Helper function to calculate average
function calculateRataRata(nilaiItem) {
    const values = [
        nilaiItem.matematika,
        nilaiItem.bahasaIndonesia,
        nilaiItem.ipa,
        nilaiItem.ips,
        nilaiItem.pkn,
        nilaiItem.sbdp,
        nilaiItem.pjok,
    ];
    const sum = values.reduce((a, b) => a + b, 0);
    return Math.round((sum / values.length) * 10) / 10;
}

// Data Keuangan
const keuanganData = {
    pemasukan: [
        {
            tanggal: "15 Jan 2023",
            sumber: "Bantuan Pemerintah",
            jumlah: 10000000,
            keterangan: "Bantuan operasional triwulan I",
        },
        {
            tanggal: "20 Mar 2023",
            sumber: "Iuran Siswa",
            jumlah: 2500000,
            keterangan: "Iuran siswa semester I",
        },
        {
            tanggal: "15 Apr 2023",
            sumber: "Donatur",
            jumlah: 5000000,
            keterangan: "Donasi dari masyarakat",
        },
    ],
    pengeluaran: [
        {
            tanggal: "15 Jan 2023",
            item: "Buku Tulis",
            kategori: "Alat Tulis",
            jumlah: 500000,
            keterangan: "Untuk peserta didik program keaksaraan",
        },
        {
            tanggal: "20 Feb 2023",
            item: "Bahan Kerajinan",
            kategori: "Bahan Praktek",
            jumlah: 750000,
            keterangan: "Untuk program keterampilan kerajinan tangan",
        },
        {
            tanggal: "10 Mar 2023",
            item: "Honor Tutor",
            kategori: "Honorarium",
            jumlah: 2000000,
            keterangan: "Honor tutor bulan Maret",
        },
        {
            tanggal: "5 Apr 2023",
            item: "Sewa Tempat",
            kategori: "Operasional",
            jumlah: 1500000,
            keterangan: "Sewa ruang belajar bulan April",
        },
        {
            tanggal: "12 Mei 2023",
            item: "ATK",
            kategori: "Alat Tulis",
            jumlah: 350000,
            keterangan: "Pembelian alat tulis kantor",
        },
    ],
};

// Data Pengajar
const pengajarData = {
    ketua: {
        nama: "Aurelius Santotinus Agung, S.Pd",
        jabatan: "Ketua PKBM Nakai Cerdas",
        foto: "images/pengajar/ketua.jpg",
        biodata: {
            tempatLahir: "Jakarta",
            tanggalLahir: "15 Agustus 1980",
            pendidikan: "S1 Pendidikan Bahasa Inggris",
            pengalaman: "10 tahun di bidang pendidikan nonformal",
            noTelepon: "081234567895",
            email: "john.doe@pkbm.pulautiga.sch.id",
        },
    },
    sekretaris: {
        nama: "Elviafri Saso, S.Pd.",
        jabatan: "Sekretaris",
        foto: "images/pengajar/sekretaris.jpg",
        biodata: {
            tempatLahir: "Bandung",
            tanggalLahir: "20 Maret 1985",
            pendidikan: "D3 Administrasi",
            pengalaman: "8 tahun di bidang administrasi pendidikan",
            noTelepon: "081234567896",
            email: "jane.smith@pkbm.pulautiga.sch.id",
        },
    },
    bendahara: {
        nama: "Nira Layuk Pake, S.Pd.",
        jabatan: "Bendahara",
        foto: "images/pengajar/bendahara.jpg",
        biodata: {
            tempatLahir: "Surabaya",
            tanggalLahir: "10 Mei 1982",
            pendidikan: "S1 Akuntansi",
            pengalaman: "12 tahun di bidang keuangan",
            noTelepon: "081234567897",
            email: "robert.brown@pkbm.pulautiga.sch.id",
        },
    },
    tutor1: {
        nama: "Lisa Johnson",
        jabatan: "Tutor Matematika & IPA",
        foto: "images/pengajar/tutor1.jpg",
        biodata: {
            tempatLahir: "Yogyakarta",
            tanggalLahir: "25 Desember 1990",
            pendidikan: "S1 Matematika",
            pengalaman: "5 tahun mengajar matematika",
            noTelepon: "081234567898",
            email: "lisa.johnson@pkbm.pulautiga.sch.id",
        },
    },
    tutor2: {
        nama: "Michael Wilson",
        jabatan: "Tutor Bahasa Indonesia & IPS",
        foto: "images/pengajar/tutor2.jpg",
        biodata: {
            tempatLahir: "Semarang",
            tanggalLahir: "15 Juli 1988",
            pendidikan: "S1 Bahasa Indonesia",
            pengalaman: "6 tahun mengajar bahasa",
            noTelepon: "081234567899",
            email: "michael.wilson@pkbm.pulautiga.sch.id",
        },
    },
};

// Utility functions
window.PKBM.formatRupiah = function (angka) {
    if (!angka) return "0";
    return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
};

function formatRupiah(angka) {
    return new Intl.NumberFormat("id-ID").format(angka);
}

function calculateRataRataTable(nilai) {
    const total =
        nilai.matematika +
        nilai.bahasaIndonesia +
        nilai.ipa +
        nilai.ips +
        nilai.pkn +
        nilai.sbdp +
        nilai.pjok;
    return (total / 7).toFixed(2);
}

function smoothScroll(target) {
    const targetElement = document.querySelector(target);
    if (targetElement) {
        const offsetTop = targetElement.offsetTop - 100;
        window.scrollTo({
            top: offsetTop,
            behavior: "smooth",
        });
    }
}

// MAIN INITIALIZATION - FIXED MOBILE MENU
document.addEventListener("DOMContentLoaded", function () {
    console.log("PKBM Pulau Tiga Website Initialized");
    
    // Initialize mobile menu first
    initMobileMenu();
    
    // Initialize other components
    initDataTables();
    initEventListeners();
    initScrollAnimations();
    
    // Initialize charts if they exist
    if (window.initCharts) {
        setTimeout(window.initCharts, 1000);
    }
});

// FIXED MOBILE MENU FUNCTION
function initMobileMenu() {
    const mobileMenuBtn = document.querySelector(".mobile-menu-btn");
    const navLinks = document.querySelector(".nav-links");
    
    console.log("Mobile menu elements:", { mobileMenuBtn, navLinks });

    if (!mobileMenuBtn || !navLinks) {
        console.error("Mobile menu elements not found");
        return;
    }

    // Mobile menu toggle
    mobileMenuBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        console.log("Mobile menu button clicked");
        
        navLinks.classList.toggle("active");
        mobileMenuBtn.classList.toggle("active");
        
        // Toggle icon
        const icon = this.querySelector("i");
        if (navLinks.classList.contains("active")) {
            icon.classList.remove("fa-bars");
            icon.classList.add("fa-times");
            document.body.style.overflow = "hidden";
        } else {
            icon.classList.remove("fa-times");
            icon.classList.add("fa-bars");
            document.body.style.overflow = "";
        }
    });

    // Mobile sub-menu functionality
    document.querySelectorAll(".nav-item.has-submenu > a").forEach(link => {
        link.addEventListener("click", function (e) {
            if (window.innerWidth <= 768) {
                e.preventDefault();
                const parent = this.parentElement;
                const subMenu = parent.querySelector(".sub-menu");
                
                console.log("Sub-menu clicked:", parent);
                
                // Close other sub-menus
                document.querySelectorAll(".nav-item.has-submenu").forEach(item => {
                    if (item !== parent) {
                        item.classList.remove("submenu-active");
                        const otherSubMenu = item.querySelector(".sub-menu");
                        if (otherSubMenu) {
                            otherSubMenu.style.maxHeight = "0";
                        }
                    }
                });
                
                // Toggle current sub-menu
                if (subMenu) {
                    parent.classList.toggle("submenu-active");
                    if (parent.classList.contains("submenu-active")) {
                        subMenu.style.maxHeight = subMenu.scrollHeight + "px";
                    } else {
                        subMenu.style.maxHeight = "0";
                    }
                }
            }
        });
    });

    // Close mobile menu when clicking on regular links
    document.querySelectorAll(".nav-item:not(.has-submenu) > a").forEach(link => {
        link.addEventListener("click", function () {
            if (window.innerWidth <= 768) {
                navLinks.classList.remove("active");
                mobileMenuBtn.classList.remove("active");
                const icon = mobileMenuBtn.querySelector("i");
                icon.classList.remove("fa-times");
                icon.classList.add("fa-bars");
                document.body.style.overflow = "";
            }
        });
    });

    // Close mobile menu when clicking outside
    document.addEventListener("click", function (event) {
        if (navLinks.classList.contains("active") && 
            !navLinks.contains(event.target) && 
            !mobileMenuBtn.contains(event.target)) {
            console.log("Closing mobile menu - clicked outside");
            
            navLinks.classList.remove("active");
            mobileMenuBtn.classList.remove("active");
            const icon = mobileMenuBtn.querySelector("i");
            icon.classList.remove("fa-times");
            icon.classList.add("fa-bars");
            document.body.style.overflow = "";
            
            // Close all sub-menus
            document.querySelectorAll(".nav-item.has-submenu").forEach(item => {
                item.classList.remove("submenu-active");
                const subMenu = item.querySelector(".sub-menu");
                if (subMenu) {
                    subMenu.style.maxHeight = "0";
                }
            });
        }
    });

    // Handle window resize
    window.addEventListener("resize", function () {
        if (window.innerWidth > 768) {
            // Reset mobile menu on desktop
            navLinks.classList.remove("active");
            mobileMenuBtn.classList.remove("active");
            const icon = mobileMenuBtn.querySelector("i");
            icon.classList.remove("fa-times");
            icon.classList.add("fa-bars");
            document.body.style.overflow = "";
            
            // Reset all sub-menus
            document.querySelectorAll(".nav-item.has-submenu").forEach(item => {
                item.classList.remove("submenu-active");
                const subMenu = item.querySelector(".sub-menu");
                if (subMenu) {
                    subMenu.style.maxHeight = "none";
                }
            });
        }
    });
}

// Data Table Functions
function initDataTables() {
    loadSiswaData();
    loadNilaiData();
    loadKeuanganData();
}

function loadSiswaData() {
    const tbody = document.querySelector("#data-siswa tbody");
    if (!tbody) return;

    tbody.innerHTML = "";

    siswaData.forEach((siswa) => {
        const row = document.createElement("tr");
        row.setAttribute("data-id", siswa.id);
        row.classList.add("clickable");

        row.innerHTML = `
            <td>${siswa.id}</td>
            <td class="clickable">${siswa.nama}</td>
            <td>${siswa.jenisKelamin}</td>
            <td>${siswa.umur}</td>
            <td>${siswa.program}</td>
            <td>${siswa.tanggalBergabung}</td>
        `;

        tbody.appendChild(row);
    });

    // Add click event for student details
    document.querySelectorAll("#data-siswa tbody tr").forEach((row) => {
        row.addEventListener("click", function () {
            const siswaId = this.getAttribute("data-id");
            const siswa = siswaData.find((s) => s.id == siswaId);
            if (siswa) {
                showSiswaDetail(siswa);
            }
        });
    });
}

function loadNilaiData() {
    const tbody = document.querySelector("#nilaiTable tbody");
    if (!tbody) return;

    tbody.innerHTML = "";

    nilaiData.forEach((nilai) => {
        const rataRata = calculateRataRataTable(nilai);
        const row = document.createElement("tr");
        row.setAttribute("data-id", nilai.id);
        row.classList.add("clickable");

        row.innerHTML = `
            <td class="clickable">${nilai.nama}</td>
            <td>${nilai.matematika}</td>
            <td>${nilai.bahasaIndonesia}</td>
            <td>${nilai.ipa}</td>
            <td>${nilai.ips}</td>
            <td><strong>${rataRata}</strong></td>
        `;

        tbody.appendChild(row);
    });

    // Add click event for nilai details
    document.querySelectorAll("#nilaiTable tbody tr").forEach((row) => {
        row.addEventListener("click", function () {
            const nilaiId = this.getAttribute("data-id");
            const nilai = nilaiData.find((n) => n.id == nilaiId);
            const siswa = siswaData.find((s) => s.id == nilaiId);
            if (nilai && siswa) {
                showNilaiDetail(nilai, siswa);
            }
        });
    });
}

function loadKeuanganData() {
    loadPemasukanData();
    loadPengeluaranData();
}

function loadPemasukanData() {
    const tbody = document.querySelector("#pemasukanTable tbody");
    if (!tbody) return;

    tbody.innerHTML = "";

    keuanganData.pemasukan.forEach((item, index) => {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${item.tanggal}</td>
            <td>${item.sumber}</td>
            <td>Rp ${formatRupiah(item.jumlah)}</td>
            <td>${item.keterangan}</td>
        `;

        tbody.appendChild(row);
    });
}

function loadPengeluaranData() {
    const tbody = document.querySelector("#pengeluaranTable tbody");
    if (!tbody) return;

    tbody.innerHTML = "";

    keuanganData.pengeluaran.forEach((item, index) => {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${item.tanggal}</td>
            <td>${item.item}</td>
            <td>${item.kategori}</td>
            <td>Rp ${formatRupiah(item.jumlah)}</td>
            <td>${item.keterangan}</td>
        `;

        tbody.appendChild(row);
    });
}

function initEventListeners() {
    // Detail buttons for organization members
    document.querySelectorAll(".btn-detail").forEach((button) => {
        button.addEventListener("click", function () {
            const memberId = this.closest("[data-id]").getAttribute("data-id");
            const memberData = pengajarData[memberId];
            if (memberData) {
                showPengajarDetail(memberData);
            }
        });
    });

    // Export buttons
    document.querySelectorAll(".btn-export").forEach((button) => {
        button.addEventListener("click", function () {
            const exportType = this.getAttribute("data-type");
            if (typeof exportToPDF === "function") {
                exportToPDF(exportType);
            }
        });
    });

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
            if (this.getAttribute("href") !== "#") {
                e.preventDefault();
                smoothScroll(this.getAttribute("href"));
            }
        });
    });
}

function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                entry.target.classList.add("fade-in");
            }
        });
    }, observerOptions);

    // Observe all elements that should animate on scroll
    document
        .querySelectorAll(
            ".section-title, .card, .org-member, .tutor-card, .gallery-item, .data-table, .chart-container"
        )
        .forEach((el) => {
            observer.observe(el);
        });
}

// Tab navigation
function initTabNavigation() {
    const tabButtons = document.querySelectorAll(".tab-btn");

    tabButtons.forEach((button) => {
        button.addEventListener("click", function () {
            const tabId = this.getAttribute("data-tab");

            // Remove active class from all buttons and contents
            document.querySelectorAll(".tab-btn").forEach((btn) => {
                btn.classList.remove("active");
            });
            document.querySelectorAll(".tab-content").forEach((content) => {
                content.classList.remove("active");
            });

            // Add active class to current button and content
            this.classList.add("active");
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add("active");

                // Initialize charts when tab becomes active
                if (
                    tabId === "statistik" ||
                    tabId === "grafik-nilai" ||
                    tabId === "saldo"
                ) {
                    setTimeout(() => {
                        if (typeof initCharts === "function") {
                            initCharts();
                        }
                    }, 100);
                }
            }
        });
    });
}

// Export functions for other modules
window.PKBM = {
    siswaData,
    nilaiData,
    keuanganData,
    pengajarData,
    formatRupiah,
    calculateRataRata: calculateRataRataTable,
};

// Export for module systems
if (typeof module !== "undefined" && module.exports) {
    module.exports = { siswaData, nilaiData };
}